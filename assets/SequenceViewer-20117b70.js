import{r as a,j as o,M as H,B as j,b as h,I,L as k}from"./index-c216c5b7.js";const A=e=>new Promise(t=>{const n=new Image;n.onload=()=>{t(n)},n.src=e}),F=async e=>{const t=await Promise.all(e);return await Promise.all(t.map(s=>createImageBitmap(s,0,0,s.width,s.height)))},O=(e,t,n="webp",s=2)=>{const[r,c]=a.useState([]);return a.useEffect(()=>{const i=[];for(let l=1;l<=e;l++)i.push(A(`/insect-360/${t}${l.toString().padStart(s,"0")}.${n}`));(async()=>{const l=await F(i);c(l)})()},[]),r},Z=(e,t,n)=>{const s=Math.min(2,window.devicePixelRatio);e.width=t*s,e.height=n*s},G=(e,t,n,s,r,c)=>{const i=e.getContext("2d");i&&(i.clearRect(0,0,e.width,e.height),i.drawImage(t,n,s,r,c))},J=(e,t)=>{const n=e.width/t.width,s=e.height/t.height;return Math.min(n,s)},K=(e,t,n,s)=>{const r=(e.width-t*s)/2,c=(e.height-n*s)/2;return[r,c]},Q={"img-canvas":"_img-canvas_9f20v_1"},L=({img:e,zoomLevel:t=0,panningEnabled:n=!1})=>{const s=a.useRef(null),[r,c]=a.useState(!1),[i,l]=a.useState({x:0,y:0}),[m,g]=a.useState(t),[f,b]=a.useState(0),[v,M]=a.useState(0),[S,B]=a.useState(0),[$,N]=a.useState(0),[T,V]=a.useState(null),[U,W]=a.useState(null),_=()=>{if(e&&s.current){const u=s.current,d=u.clientWidth,w=u.clientHeight;if(t!==m||d!==T||w!==U){Z(u,u.clientWidth,u.clientHeight);const p=J(u,e)+t,x=Math.min(e.width,e.width*p),y=Math.min(e.height,e.height*p),[Y,z]=K(u,x,y,1);B(x),N(y),b(Y),M(z),V(d),W(w),g(t)}}};a.useEffect(()=>(_(),window.addEventListener("resize",_),()=>{window.removeEventListener("resize",_)}),[e,t]),a.useEffect(()=>{e&&s.current&&G(s.current,e,f,v,S,$)},[e,f,v,S,$]);const D=u=>{if(t>0){const d="touches"in u?u.touches[0]:u;c(!0),l({x:d.clientX,y:d.clientY})}},P=u=>{const d="touches"in u?u.touches[0]:u;if(r&&s.current){const w=s.current,p=f+(d.clientX-i.x)*Math.min(window.devicePixelRatio,2),x=v+(d.clientY-i.y)*Math.min(window.devicePixelRatio,2);p<=0&&p>=w.offsetWidth-S&&b(p),x<=0&&x>=w.offsetHeight-$&&M(x),l({x:d.clientX,y:d.clientY})}},C=()=>{c(!1)},X=()=>{c(!1)};return o.jsx("canvas",{className:Q["img-canvas"],ref:s,onMouseDown:n?D:void 0,onMouseMove:n?P:void 0,onMouseUp:n?C:void 0,onTouchStart:n?D:void 0,onTouchMove:n?P:void 0,onTouchEnd:n?C:void 0,onPointerLeave:n?X:void 0})},E={"photo-info-modal":"_photo-info-modal_uf2no_1","photo-info":"_photo-info_uf2no_1"},ee=({content:e})=>{const t=n=>({__html:n});return o.jsx("div",{className:E["photo-info"],dangerouslySetInnerHTML:t(e)})},te=({setOpen:e,content:t})=>o.jsx(H,{modalAdjustmentClasses:E["photo-info-modal"],setOpen:e,animationDirection:"fade",size:"small",children:o.jsx(ee,{content:t})}),se=e=>{const[t,n]=a.useState(null);return a.useEffect(()=>{const s=new Image;s.onload=()=>{n(s)},s.src=e},[e]),t},ne={"zoom-btns":"_zoom-btns_1o18k_1"},oe=({zoomLevel:e,setZoomLevel:t})=>{const n=c=>c+.5,s=c=>c-.5,r=c=>{t(i=>c?n(i):s(i))};return o.jsxs("div",{className:ne["zoom-btns"],children:[o.jsx(j,{classes:`${h["btn--dark"]} ${h["btn--square"]}`,handleClick:()=>{r(!1)},disabled:e===0,children:o.jsx(I,{icon:"zoom out"})}),o.jsx(j,{classes:`${h["btn--dark"]} ${h["btn--square"]}`,handleClick:()=>{r(!0)},disabled:e>=1,children:o.jsx(I,{icon:"zoom in"})})]})},q={"photo-viewer":"_photo-viewer_4rn8i_1","photo-viewer--is-grabbing":"_photo-viewer--is-grabbing_4rn8i_1"},ae=({imgPath:e})=>{const t=se(e),[n,s]=a.useState(0),[r,c]=a.useState(!0),[i,l]=a.useState(!1);a.useEffect(()=>{t&&t.complete&&c(!1)},[t]);const m=()=>{l(!0)},g=()=>{l(!1)},f=()=>{l(!1)};return o.jsxs("div",{className:`${q["photo-viewer"]} ${i?q["photo-viewer--is-grabbing"]:""}`,onMouseDown:m,onMouseUp:g,onMouseLeave:f,children:[r&&o.jsx(k,{}),o.jsx(oe,{setZoomLevel:s,zoomLevel:n}),o.jsx(L,{img:t,zoomLevel:n,panningEnabled:!0})]})},ce=({setOpen:e,imgPath:t})=>o.jsx(H,{setOpen:e,animationDirection:"fade",theme:"dark",children:o.jsx(ae,{imgPath:t})}),ie=({classes:e,handleClick:t})=>o.jsx(j,{classes:`${e||""} ${h["btn--dark"]}  ${h["btn--square"]}`,handleClick:t,children:o.jsx(I,{icon:"expand"})}),re=({classes:e,handleClick:t})=>o.jsx(j,{classes:`${e||""} ${h["btn--dark"]} ${h["btn--square"]}`,handleClick:t,children:o.jsx(I,{icon:"info"})});const ue=({min:e,max:t,value:n,setTimelineIndex:s})=>{const r=c=>{s(c.target.valueAsNumber)};return o.jsx("input",{className:"timeline-scrubber",type:"range",step:1,min:e,max:t,value:n,onChange:r})},R={"info-btn":"_info-btn_1gh04_1","expand-btn":"_expand-btn_1gh04_2"},le=({setDisplayPhotoInfo:e,setDisplayPhotoViewer:t,activeImgIndex:n,setActiveImgIndex:s,imgCount:r})=>{const c=()=>{e(!0)},i=()=>{t(!0)};return o.jsxs(o.Fragment,{children:[o.jsx(re,{classes:R["info-btn"],handleClick:c}),o.jsx(ie,{classes:R["expand-btn"],handleClick:i}),o.jsx(ue,{min:0,max:r-1,value:n,setTimelineIndex:s})]})},de={"sequence-viewer":"_sequence-viewer_90l84_1"},fe=({species:{images:e,meta:t}})=>{const n=O(e.sequenceFramecount,e.sequence.path),[s,r]=a.useState(0),[c,i]=a.useState(!1),[l,m]=a.useState(!1),[g,f]=a.useState(!0),[b,v]=a.useState(`/insect-360/${e.sequenceHiRes.path}${(s+1).toString().padStart(2,"0")}.${e.sequenceHiRes.filetype}`);return a.useEffect(()=>{n.length===e.sequenceFramecount&&f(!1)},[n]),a.useEffect(()=>{v(`/insect-360/${e.sequenceHiRes.path}${(s+1).toString().padStart(2,"0")}.${e.sequenceHiRes.filetype}`)},[e,s]),o.jsxs("div",{className:de["sequence-viewer"],children:[g&&o.jsx(k,{}),o.jsx(le,{setDisplayPhotoInfo:i,setDisplayPhotoViewer:m,activeImgIndex:s,setActiveImgIndex:r,imgCount:e.sequenceFramecount}),o.jsx(L,{img:n[s]}),c&&o.jsx(te,{setOpen:i,content:t.photoInfo}),l&&o.jsx(ce,{setOpen:m,imgPath:b})]})};export{fe as default};
