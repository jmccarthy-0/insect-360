import{r as a,j as o,M as L,B as I,b as h,I as j,L as H}from"./index-5a5e8028.js";const Y=e=>new Promise(t=>{const n=new Image;n.onload=()=>{t(n)},n.src=e}),z=async e=>{const t=await Promise.all(e);return await Promise.all(t.map(s=>createImageBitmap(s,0,0,s.width,s.height)))},A=(e,t,n="webp",s=2)=>{const[r,i]=a.useState([]);return a.useEffect(()=>{const c=[];for(let u=1;u<=e;u++)c.push(Y(`/insect-360/${t}${u.toString().padStart(s,"0")}.${n}`));(async()=>{const u=await z(c);i(u)})()},[]),r},F=(e,t,n)=>{const s=Math.min(2,window.devicePixelRatio);e.width=t*s,e.height=n*s},G=(e,t,n,s,r,i)=>{const c=e.getContext("2d");c&&(c.clearRect(0,0,e.width,e.height),c.drawImage(t,n,s,r,i))},J=(e,t)=>{const n=e.width/t.width,s=e.height/t.height;return Math.min(n,s)},K=(e,t,n,s)=>{const r=(e.width-t*s)/2,i=(e.height-n*s)/2;return[r,i]},Q={"img-canvas":"_img-canvas_9f20v_1"},k=({img:e,zoomLevel:t=0,panningEnabled:n=!1})=>{const s=a.useRef(null),[r,i]=a.useState(!1),[c,u]=a.useState({x:0,y:0}),[m,g]=a.useState(t),[f,b]=a.useState(0),[v,_]=a.useState(0),[S,V]=a.useState(0),[M,B]=a.useState(0),[N,T]=a.useState(null),[U,W]=a.useState(null),$=()=>{if(e&&s.current){const l=s.current,d=l.clientWidth,w=l.clientHeight;if(t!==m||d!==N||w!==U){F(l,l.clientWidth,l.clientHeight);const p=J(l,e)+t,x=Math.min(e.width,e.width*p),y=Math.min(e.height,e.height*p),[O,X]=K(l,x,y,1);V(x),B(y),b(O),_(X),T(d),W(w),g(t)}}};a.useEffect(()=>($(),window.addEventListener("resize",$),()=>{window.removeEventListener("resize",$)}),[e,t]),a.useEffect(()=>{e&&s.current&&G(s.current,e,f,v,S,M)},[e,f,v,S,M]);const P=l=>{if(t>0){const d="touches"in l?l.touches[0]:l;i(!0),u({x:d.clientX,y:d.clientY})}},C=l=>{const d="touches"in l?l.touches[0]:l;if(r&&s.current){const w=s.current,p=f+(d.clientX-c.x)*Math.min(window.devicePixelRatio,2),x=v+(d.clientY-c.y)*Math.min(window.devicePixelRatio,2);p<=0&&p>=w.offsetWidth-S&&b(p),x<=0&&x>=w.offsetHeight-M&&_(x),u({x:d.clientX,y:d.clientY})}},D=()=>{i(!1)},Z=()=>{i(!1)};return o.jsx("canvas",{className:Q["img-canvas"],ref:s,onMouseDown:n?P:void 0,onMouseMove:n?C:void 0,onMouseUp:n?D:void 0,onTouchStart:n?P:void 0,onTouchMove:n?C:void 0,onTouchEnd:n?D:void 0,onPointerLeave:n?Z:void 0})},E={"photo-info-modal":"_photo-info-modal_uf2no_1","photo-info":"_photo-info_uf2no_1"},ee=({content:e})=>{const t=n=>({__html:n});return o.jsx("div",{className:E["photo-info"],dangerouslySetInnerHTML:t(e)})},te=({setOpen:e,content:t})=>o.jsx(L,{id:"photoInfoModal",modalAdjustmentClasses:E["photo-info-modal"],setOpen:e,animationDirection:"fade",size:"small",children:o.jsx(ee,{content:t})}),se=e=>{const[t,n]=a.useState(null);return a.useEffect(()=>{const s=new Image;s.onload=()=>{n(s)},s.src=e},[e]),t},ne={"zoom-btns":"_zoom-btns_1o18k_1"},oe=({zoomLevel:e,setZoomLevel:t})=>{const n=i=>i+.5,s=i=>i-.5,r=i=>{t(c=>i?n(c):s(c))};return o.jsxs("div",{className:ne["zoom-btns"],children:[o.jsx(I,{classes:`${h["btn--dark"]} ${h["btn--square"]}`,handleClick:()=>{r(!1)},disabled:e===0,ariaLabel:"Zoom Out",children:o.jsx(j,{icon:"zoom out"})}),o.jsx(I,{classes:`${h["btn--dark"]} ${h["btn--square"]}`,handleClick:()=>{r(!0)},disabled:e>=1,ariaLabel:"Zoom In",children:o.jsx(j,{icon:"zoom in"})})]})},q={"photo-viewer":"_photo-viewer_4rn8i_1","photo-viewer--is-grabbing":"_photo-viewer--is-grabbing_4rn8i_1"},ae=({imgPath:e})=>{const t=se(e),[n,s]=a.useState(0),[r,i]=a.useState(!0),[c,u]=a.useState(!1);a.useEffect(()=>{t&&t.complete&&i(!1)},[t]);const m=()=>{u(!0)},g=()=>{u(!1)},f=()=>{u(!1)};return o.jsxs("div",{className:`${q["photo-viewer"]} ${c?q["photo-viewer--is-grabbing"]:""}`,onMouseDown:m,onMouseUp:g,onMouseLeave:f,children:[r&&o.jsx(H,{}),o.jsx(oe,{setZoomLevel:s,zoomLevel:n}),o.jsx(k,{img:t,zoomLevel:n,panningEnabled:!0})]})},ie=({setOpen:e,imgPath:t})=>o.jsx(L,{id:"photoViewerModal",setOpen:e,animationDirection:"fade",theme:"dark",children:o.jsx(ae,{imgPath:t})}),ce=({classes:e,handleClick:t})=>o.jsx(I,{classes:`${e||""} ${h["btn--dark"]}  ${h["btn--square"]}`,handleClick:t,ariaLabel:"Expand Image",ariaControls:"photoViewerModal",children:o.jsx(j,{icon:"expand"})}),re=({classes:e,handleClick:t})=>o.jsx(I,{classes:`${e||""} ${h["btn--dark"]} ${h["btn--square"]}`,handleClick:t,ariaLabel:"Photo Info",ariaControls:"photoInfoModal",children:o.jsx(j,{icon:"info"})});const le=({min:e,max:t,value:n,setTimelineIndex:s})=>{const r=i=>{s(i.target.valueAsNumber)};return o.jsx("input",{className:"timeline-scrubber",type:"range",step:1,min:e,max:t,value:n,onChange:r,"aria-label":"Set current image index"})},R={"info-btn":"_info-btn_1gh04_1","expand-btn":"_expand-btn_1gh04_2"},ue=({setDisplayPhotoInfo:e,setDisplayPhotoViewer:t,activeImgIndex:n,setActiveImgIndex:s,imgCount:r})=>{const i=()=>{e(!0)},c=()=>{t(!0)};return o.jsxs(o.Fragment,{children:[o.jsx(re,{classes:R["info-btn"],handleClick:i}),o.jsx(ce,{classes:R["expand-btn"],handleClick:c}),o.jsx(le,{min:0,max:r-1,value:n,setTimelineIndex:s})]})},de={"sequence-viewer":"_sequence-viewer_90l84_1"},fe=({species:{images:e,meta:t}})=>{const n=A(e.sequenceFramecount,e.sequence.path),[s,r]=a.useState(0),[i,c]=a.useState(!1),[u,m]=a.useState(!1),[g,f]=a.useState(!0),[b,v]=a.useState(`/insect-360/${e.sequenceHiRes.path}${(s+1).toString().padStart(2,"0")}.${e.sequenceHiRes.filetype}`);return a.useEffect(()=>{n.length===e.sequenceFramecount&&f(!1)},[n]),a.useEffect(()=>{v(`/insect-360/${e.sequenceHiRes.path}${(s+1).toString().padStart(2,"0")}.${e.sequenceHiRes.filetype}`)},[e,s]),o.jsxs("div",{className:de["sequence-viewer"],children:[g&&o.jsx(H,{}),o.jsx(ue,{setDisplayPhotoInfo:c,setDisplayPhotoViewer:m,activeImgIndex:s,setActiveImgIndex:r,imgCount:e.sequenceFramecount}),o.jsx(k,{img:n[s]}),i&&o.jsx(te,{setOpen:c,content:t.photoInfo}),u&&o.jsx(ie,{setOpen:m,imgPath:b})]})};export{fe as default};
