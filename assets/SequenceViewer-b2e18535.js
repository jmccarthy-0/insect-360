import{r as c,j as o,M,B as v,b as f,I as j,L as C}from"./index-85e57e77.js";const B=e=>new Promise(t=>{const n=new Image;n.onload=()=>{t(n)},n.src=e}),E=async e=>{const t=await Promise.all(e);return await Promise.all(t.map(s=>createImageBitmap(s,0,0,s.width,s.height)))},N=(e,t,n="webp",s=2)=>{const[i,a]=c.useState([]);return c.useEffect(()=>{const r=[];for(let d=1;d<=e;d++)r.push(B(`${t}${d.toString().padStart(s,"0")}.${n}`));(async()=>{const d=await E(r);a(d)})()},[]),i},T=(e,t,n)=>{const s=Math.min(2,window.devicePixelRatio);e.width=t*s,e.height=n*s},P=(e,t,n,s,i,a)=>{const r=e.getContext("2d");r&&(r.clearRect(0,0,e.width,e.height),r.drawImage(t,n,s,i,a))},V=(e,t)=>{const n=e.width/t.width,s=e.height/t.height;return Math.min(n,s)},Y=(e,t,n,s)=>{const i=(e.width-t*s)/2,a=(e.height-n*s)/2;return[i,a]},z={"img-canvas":"_img-canvas_9f20v_1"},q=({img:e,zoomLevel:t=0,panningEnabled:n=!1})=>{const s=c.useRef(null),[i,a]=c.useState(!1),[r,d]=c.useState({x:0,y:0}),[h,g]=c.useState(0),[m,w]=c.useState(0),[I,k]=c.useState(0),[H,L]=c.useState(0);c.useEffect(()=>{if(e&&s.current){const l=s.current;T(l,l.clientWidth,l.clientHeight);const u=V(l,e)+t,x=Math.min(e.width,e.width*u),p=Math.min(e.height,e.height*u),[D,$]=Y(l,x,p,1);k(x),L(p),g(D),w($),P(s.current,e,D,$,x,p)}},[e,t]),c.useEffect(()=>{e&&s.current&&P(s.current,e,h,m,I,H)},[h,m]);const S=l=>{if(t>0){const u="touches"in l?l.touches[0]:l;a(!0),d({x:u.clientX,y:u.clientY})}},b=l=>{const u="touches"in l?l.touches[0]:l;if(i){const x=h+(u.clientX-r.x)*Math.min(window.devicePixelRatio,2),p=m+(u.clientY-r.y)*Math.min(window.devicePixelRatio,2);g(x),w(p),d({x:u.clientX,y:u.clientY})}},_=()=>{a(!1)};return o.jsx("canvas",{className:z["img-canvas"],ref:s,onMouseDown:n?S:void 0,onMouseMove:n?b:void 0,onMouseUp:n?_:void 0,onTouchStart:n?S:void 0,onTouchMove:n?b:void 0,onTouchEnd:n?_:void 0})},R={"photo-info-modal":"_photo-info-modal_1alst_1","photo-info":"_photo-info_1alst_1"},X=({content:e})=>{const t=n=>({__html:n});return o.jsx("div",{className:R["photo-info"],dangerouslySetInnerHTML:t(e)})},A=({setOpen:e,content:t})=>o.jsx(M,{modalAdjustmentClasses:R["photo-info-modal"],setOpen:e,animationDirection:"fade",size:"small",children:o.jsx(X,{content:t})}),F=e=>{const[t,n]=c.useState(null);return c.useEffect(()=>{const s=new Image;s.onload=()=>{n(s)},s.src=e},[e]),t},O={"zoom-btns":"_zoom-btns_1gr0e_1"},U=({zoomLevel:e,setZoomLevel:t})=>{const n=a=>a+.5,s=a=>a-.5,i=a=>{t(r=>a?n(r):s(r))};return o.jsxs("div",{className:O["zoom-btns"],children:[o.jsx(v,{classes:`${f["btn--dark"]}`,handleClick:()=>{i(!0)},disabled:e>=1,children:o.jsx(j,{icon:"zoom in"})}),o.jsx(v,{classes:`${f["btn--dark"]}`,handleClick:()=>{i(!1)},disabled:e===0,children:o.jsx(j,{icon:"zoom out"})})]})},Z={"photo-viewer":"_photo-viewer_15pq0_1"},W=({imgPath:e})=>{const t=F(e),[n,s]=c.useState(0),[i,a]=c.useState(!0);return c.useEffect(()=>{t&&t.complete&&a(!1)},[t]),o.jsxs("div",{className:Z["photo-viewer"],children:[i&&o.jsx(C,{}),o.jsx(U,{setZoomLevel:s,zoomLevel:n}),o.jsx(q,{img:t,zoomLevel:n,panningEnabled:!0})]})},G=({setOpen:e,imgPath:t})=>o.jsx(M,{setOpen:e,animationDirection:"right",theme:"dark",children:o.jsx(W,{imgPath:t})}),J=({classes:e,handleClick:t})=>o.jsx(v,{classes:`${e||""} ${f["btn--dark"]}  ${f["btn--square"]}`,handleClick:t,children:o.jsx(j,{icon:"expand"})}),K=({classes:e,handleClick:t})=>o.jsx(v,{classes:`${e||""} ${f["btn--dark"]} ${f["btn--square"]}`,handleClick:t,children:o.jsx(j,{icon:"info"})});const Q=({min:e,max:t,value:n,setTimelineIndex:s})=>{const i=a=>{s(a.target.valueAsNumber)};return o.jsx("input",{className:"timeline-scrubber",type:"range",step:1,min:e,max:t,value:n,onChange:i})},y={"info-btn":"_info-btn_1gh04_1","expand-btn":"_expand-btn_1gh04_2"},ee=({setDisplayPhotoInfo:e,setDisplayPhotoViewer:t,activeImgIndex:n,setActiveImgIndex:s,imgCount:i})=>{const a=()=>{e(!0)},r=()=>{t(!0)};return o.jsxs(o.Fragment,{children:[o.jsx(K,{classes:y["info-btn"],handleClick:a}),o.jsx(J,{classes:y["expand-btn"],handleClick:r}),o.jsx(Q,{min:0,max:i-1,value:n,setTimelineIndex:s})]})},te={"sequence-viewer":"_sequence-viewer_90l84_1"},ne=({species:{images:e,meta:t}})=>{const n=N(e.sequenceFramecount,e.sequence.path),[s,i]=c.useState(0),[a,r]=c.useState(!1),[d,h]=c.useState(!1),[g,m]=c.useState(!0),[w,I]=c.useState(`${e.sequenceHiRes.path}${(s+1).toString().padStart(2,"0")}.${e.sequenceHiRes.filetype}`);return c.useEffect(()=>{n.length===e.sequenceFramecount&&m(!1)},[n]),c.useEffect(()=>{I(`${e.sequenceHiRes.path}${(s+1).toString().padStart(2,"0")}.${e.sequenceHiRes.filetype}`)},[e,s]),o.jsxs("div",{className:te["sequence-viewer"],children:[g&&o.jsx(C,{}),o.jsx(ee,{setDisplayPhotoInfo:r,setDisplayPhotoViewer:h,activeImgIndex:s,setActiveImgIndex:i,imgCount:e.sequenceFramecount}),o.jsx(q,{img:n[s]}),a&&o.jsx(A,{setOpen:r,content:t.photoInfo}),d&&o.jsx(G,{setOpen:h,imgPath:w})]})};export{ne as default};
