import{r as i,j as o,M as y,B as v,b as m,I as b,L as C}from"./index-1b7804f0.js";const E=e=>new Promise(t=>{const n=new Image;n.onload=()=>{t(n)},n.src=e}),N=async e=>{const t=await Promise.all(e);return await Promise.all(t.map(s=>createImageBitmap(s,0,0,s.width,s.height)))},T=(e,t,n="webp",s=2)=>{const[r,c]=i.useState([]);return i.useEffect(()=>{const a=[];for(let l=1;l<=e;l++)a.push(E(`/insect-360/${t}${l.toString().padStart(s,"0")}.${n}`));(async()=>{const l=await N(a);c(l)})()},[]),r},V=(e,t,n)=>{const s=Math.min(2,window.devicePixelRatio);e.width=t*s,e.height=n*s},M=(e,t,n,s,r,c)=>{const a=e.getContext("2d");a&&(a.clearRect(0,0,e.width,e.height),a.drawImage(t,n,s,r,c))},U=(e,t)=>{const n=e.width/t.width,s=e.height/t.height;return Math.min(n,s)},Y=(e,t,n,s)=>{const r=(e.width-t*s)/2,c=(e.height-n*s)/2;return[r,c]},z={"img-canvas":"_img-canvas_9f20v_1"},R=({img:e,zoomLevel:t=0,panningEnabled:n=!1})=>{const s=i.useRef(null),[r,c]=i.useState(!1),[a,l]=i.useState({x:0,y:0}),[h,f]=i.useState(0),[x,w]=i.useState(0),[j,H]=i.useState(0),[L,B]=i.useState(0);i.useEffect(()=>{if(e&&s.current){const u=s.current;V(u,u.clientWidth,u.clientHeight);const d=U(u,e)+t,p=Math.min(e.width,e.width*d),g=Math.min(e.height,e.height*d),[$,D]=Y(u,p,g,1);H(p),B(g),f($),w(D),M(s.current,e,$,D,p,g)}},[e,t]),i.useEffect(()=>{e&&s.current&&M(s.current,e,h,x,j,L)},[h,x]);const I=u=>{if(t>0){const d="touches"in u?u.touches[0]:u;c(!0),l({x:d.clientX,y:d.clientY})}},S=u=>{const d="touches"in u?u.touches[0]:u;if(r){const p=h+(d.clientX-a.x)*Math.min(window.devicePixelRatio,2),g=x+(d.clientY-a.y)*Math.min(window.devicePixelRatio,2);f(p),w(g),l({x:d.clientX,y:d.clientY})}},_=()=>{c(!1)};return o.jsx("canvas",{className:z["img-canvas"],ref:s,onMouseDown:n?I:void 0,onMouseMove:n?S:void 0,onMouseUp:n?_:void 0,onTouchStart:n?I:void 0,onTouchMove:n?S:void 0,onTouchEnd:n?_:void 0})},k={"photo-info-modal":"_photo-info-modal_j1qqq_1","photo-info":"_photo-info_j1qqq_1"},X=({content:e})=>{const t=n=>({__html:n});return o.jsx("div",{className:k["photo-info"],dangerouslySetInnerHTML:t(e)})},A=({setOpen:e,content:t})=>o.jsx(y,{modalAdjustmentClasses:k["photo-info-modal"],setOpen:e,animationDirection:"fade",size:"small",children:o.jsx(X,{content:t})}),F=e=>{const[t,n]=i.useState(null);return i.useEffect(()=>{const s=new Image;s.onload=()=>{n(s)},s.src=e},[e]),t},O={"zoom-btns":"_zoom-btns_1l7gd_1"},G=({zoomLevel:e,setZoomLevel:t})=>{const n=c=>c+.5,s=c=>c-.5,r=c=>{t(a=>c?n(a):s(a))};return o.jsxs("div",{className:O["zoom-btns"],children:[o.jsx(v,{classes:`${m["btn--dark"]}`,handleClick:()=>{r(!1)},disabled:e===0,children:o.jsx(b,{icon:"zoom out"})}),o.jsx(v,{classes:`${m["btn--dark"]}`,handleClick:()=>{r(!0)},disabled:e>=1,children:o.jsx(b,{icon:"zoom in"})})]})},P={"photo-viewer":"_photo-viewer_4rn8i_1","photo-viewer--is-grabbing":"_photo-viewer--is-grabbing_4rn8i_1"},Z=({imgPath:e})=>{const t=F(e),[n,s]=i.useState(0),[r,c]=i.useState(!0),[a,l]=i.useState(!1);i.useEffect(()=>{t&&t.complete&&c(!1)},[t]);const h=()=>{l(!0)},f=()=>{l(!1)};return o.jsxs("div",{className:`${P["photo-viewer"]} ${a?P["photo-viewer--is-grabbing"]:""}`,onMouseDown:h,onMouseUp:f,children:[r&&o.jsx(C,{}),o.jsx(G,{setZoomLevel:s,zoomLevel:n}),o.jsx(R,{img:t,zoomLevel:n,panningEnabled:!0})]})},W=({setOpen:e,imgPath:t})=>o.jsx(y,{setOpen:e,animationDirection:"right",theme:"dark",children:o.jsx(Z,{imgPath:t})}),J=({classes:e,handleClick:t})=>o.jsx(v,{classes:`${e||""} ${m["btn--dark"]}  ${m["btn--square"]}`,handleClick:t,children:o.jsx(b,{icon:"expand"})}),K=({classes:e,handleClick:t})=>o.jsx(v,{classes:`${e||""} ${m["btn--dark"]} ${m["btn--square"]}`,handleClick:t,children:o.jsx(b,{icon:"info"})});const Q=({min:e,max:t,value:n,setTimelineIndex:s})=>{const r=c=>{s(c.target.valueAsNumber)};return o.jsx("input",{className:"timeline-scrubber",type:"range",step:1,min:e,max:t,value:n,onChange:r})},q={"info-btn":"_info-btn_1gh04_1","expand-btn":"_expand-btn_1gh04_2"},ee=({setDisplayPhotoInfo:e,setDisplayPhotoViewer:t,activeImgIndex:n,setActiveImgIndex:s,imgCount:r})=>{const c=()=>{e(!0)},a=()=>{t(!0)};return o.jsxs(o.Fragment,{children:[o.jsx(K,{classes:q["info-btn"],handleClick:c}),o.jsx(J,{classes:q["expand-btn"],handleClick:a}),o.jsx(Q,{min:0,max:r-1,value:n,setTimelineIndex:s})]})},te={"sequence-viewer":"_sequence-viewer_90l84_1"},ne=({species:{images:e,meta:t}})=>{const n=T(e.sequenceFramecount,e.sequence.path),[s,r]=i.useState(0),[c,a]=i.useState(!1),[l,h]=i.useState(!1),[f,x]=i.useState(!0),[w,j]=i.useState(`/insect-360/${e.sequenceHiRes.path}${(s+1).toString().padStart(2,"0")}.${e.sequenceHiRes.filetype}`);return i.useEffect(()=>{n.length===e.sequenceFramecount&&x(!1)},[n]),i.useEffect(()=>{j(`/insect-360/${e.sequenceHiRes.path}${(s+1).toString().padStart(2,"0")}.${e.sequenceHiRes.filetype}`)},[e,s]),o.jsxs("div",{className:te["sequence-viewer"],children:[f&&o.jsx(C,{}),o.jsx(ee,{setDisplayPhotoInfo:a,setDisplayPhotoViewer:h,activeImgIndex:s,setActiveImgIndex:r,imgCount:e.sequenceFramecount}),o.jsx(R,{img:n[s]}),c&&o.jsx(A,{setOpen:a,content:t.photoInfo}),l&&o.jsx(W,{setOpen:h,imgPath:w})]})};export{ne as default};
