import{r as a,j as o,M as k,B as S,b as f,I as M,L as E}from"./index-5c7b3f07.js";const A=e=>new Promise(t=>{const n=new Image;n.onload=()=>{t(n)},n.src=e}),F=async e=>{const t=await Promise.all(e);return await Promise.all(t.map(s=>createImageBitmap(s,0,0,s.width,s.height)))},G=(e,t,n="webp",s=2)=>{const[r,i]=a.useState([]);return a.useEffect(()=>{const c=[];for(let u=1;u<=e;u++)c.push(A(`/insect-360/${t}${u.toString().padStart(s,"0")}.${n}`));(async()=>{const u=await F(c);i(u)})()},[]),r},J=(e,t,n)=>{const s=Math.min(2,window.devicePixelRatio);e.width=t*s,e.height=n*s},R=(e,t,n,s,r,i)=>{const c=e.getContext("2d");c&&(c.clearRect(0,0,e.width,e.height),c.drawImage(t,n,s,r,i))},K=(e,t)=>{const n=e.width/t.width,s=e.height/t.height;return Math.min(n,s)},Q=(e,t,n,s)=>{const r=(e.width-t*s)/2,i=(e.height-n*s)/2;return[r,i]},ee={"img-canvas":"_img-canvas_9f20v_1"},V=({img:e,zoomLevel:t=0,panningEnabled:n=!1})=>{const s=a.useRef(null),[r,i]=a.useState(!1),[c,u]=a.useState({x:0,y:0}),[p,v]=a.useState(t),[h,b]=a.useState(0),[m,$]=a.useState(0),[I,N]=a.useState(0),[j,T]=a.useState(0),[W,U]=a.useState(null),[Z,z]=a.useState(null),_=()=>{if(e&&s.current){const l=s.current,d=l.clientWidth,w=l.clientHeight;if(J(l,l.clientWidth,l.clientHeight),t!==p||d!==W||w!==Z){const x=K(l,e)+t,g=Math.min(e.width,e.width*x),q=Math.min(e.height,e.height*x),[X,Y]=Q(l,g,q,1);N(g),T(q),b(X),$(Y),U(d),z(w),v(t)}}},P=()=>{e&&s.current&&(_(),R(s.current,e,h,m,I,j))};a.useEffect(()=>(_(),window.addEventListener("resize",P),()=>{window.removeEventListener("resize",P)}),[e,t]),a.useEffect(()=>{e&&s.current&&R(s.current,e,h,m,I,j)},[e,h,m,I,j]);const C=l=>{if(t>0){const d="touches"in l?l.touches[0]:l;i(!0),u({x:d.clientX,y:d.clientY})}},D=l=>{const d="touches"in l?l.touches[0]:l;if(r&&s.current){const w=s.current,x=h+(d.clientX-c.x)*Math.min(window.devicePixelRatio,2),g=m+(d.clientY-c.y)*Math.min(window.devicePixelRatio,2);x<=0&&x>=w.offsetWidth-I&&b(x),g<=0&&g>=w.offsetHeight-j&&$(g),u({x:d.clientX,y:d.clientY})}},y=()=>{i(!1)},O=()=>{i(!1)};return o.jsx("canvas",{className:ee["img-canvas"],ref:s,onMouseDown:n?C:void 0,onMouseMove:n?D:void 0,onMouseUp:n?y:void 0,onTouchStart:n?C:void 0,onTouchMove:n?D:void 0,onTouchEnd:n?y:void 0,onPointerLeave:n?O:void 0})},B={"photo-info-modal":"_photo-info-modal_uf2no_1","photo-info":"_photo-info_uf2no_1"},te=({content:e})=>{const t=n=>({__html:n});return o.jsx("div",{className:B["photo-info"],dangerouslySetInnerHTML:t(e)})},se=({setOpen:e,content:t})=>o.jsx(k,{id:"photoInfoModal",modalAdjustmentClasses:B["photo-info-modal"],setOpen:e,animationDirection:"fade",size:"small",children:o.jsx(te,{content:t})}),ne=e=>{const[t,n]=a.useState(null);return a.useEffect(()=>{const s=new Image;s.onload=()=>{n(s)},s.src=e},[e]),t},oe={"zoom-btns":"_zoom-btns_1o18k_1"},ae=({zoomLevel:e,setZoomLevel:t})=>{const n=i=>i+.5,s=i=>i-.5,r=i=>{t(c=>i?n(c):s(c))};return o.jsxs("div",{className:oe["zoom-btns"],children:[o.jsx(S,{classes:`${f["btn--dark"]} ${f["btn--square"]}`,handleClick:()=>{r(!1)},disabled:e===0,ariaLabel:"Zoom Out",children:o.jsx(M,{icon:"zoom out"})}),o.jsx(S,{classes:`${f["btn--dark"]} ${f["btn--square"]}`,handleClick:()=>{r(!0)},disabled:e>=1,ariaLabel:"Zoom In",children:o.jsx(M,{icon:"zoom in"})})]})},L={"photo-viewer":"_photo-viewer_4rn8i_1","photo-viewer--is-grabbing":"_photo-viewer--is-grabbing_4rn8i_1"},ie=({imgPath:e})=>{const t=ne(e),[n,s]=a.useState(0),[r,i]=a.useState(!0),[c,u]=a.useState(!1);a.useEffect(()=>{t&&t.complete&&i(!1)},[t]);const p=()=>{u(!0)},v=()=>{u(!1)},h=()=>{u(!1)};return o.jsxs("div",{className:`${L["photo-viewer"]} ${c?L["photo-viewer--is-grabbing"]:""}`,onMouseDown:p,onMouseUp:v,onMouseLeave:h,children:[r&&o.jsx(E,{}),o.jsx(ae,{setZoomLevel:s,zoomLevel:n}),o.jsx(V,{img:t,zoomLevel:n,panningEnabled:!0})]})},ce=({setOpen:e,imgPath:t})=>o.jsx(k,{id:"photoViewerModal",setOpen:e,animationDirection:"fade",theme:"dark",children:o.jsx(ie,{imgPath:t})}),re=({classes:e,handleClick:t})=>o.jsx(S,{classes:`${e||""} ${f["btn--dark"]}  ${f["btn--square"]}`,handleClick:t,ariaLabel:"Expand Image",ariaControls:"photoViewerModal",children:o.jsx(M,{icon:"expand"})}),le=({classes:e,handleClick:t})=>o.jsx(S,{classes:`${e||""} ${f["btn--dark"]} ${f["btn--square"]}`,handleClick:t,ariaLabel:"Photo Info",ariaControls:"photoInfoModal",children:o.jsx(M,{icon:"info"})});const ue=({min:e,max:t,value:n,setTimelineIndex:s})=>{const r=i=>{s(i.target.valueAsNumber)};return o.jsx("input",{className:"timeline-scrubber",type:"range",step:1,min:e,max:t,value:n,onChange:r,"aria-label":"Set current image index"})},H={"info-btn":"_info-btn_1gh04_1","expand-btn":"_expand-btn_1gh04_2"},de=({setDisplayPhotoInfo:e,setDisplayPhotoViewer:t,activeImgIndex:n,setActiveImgIndex:s,imgCount:r})=>{const i=()=>{e(!0)},c=()=>{t(!0)};return o.jsxs(o.Fragment,{children:[o.jsx(le,{classes:H["info-btn"],handleClick:i}),o.jsx(re,{classes:H["expand-btn"],handleClick:c}),o.jsx(ue,{min:0,max:r-1,value:n,setTimelineIndex:s})]})},he={"sequence-viewer":"_sequence-viewer_90l84_1"},pe=({species:{images:e,meta:t}})=>{const n=G(e.sequenceFramecount,e.sequence.path),[s,r]=a.useState(0),[i,c]=a.useState(!1),[u,p]=a.useState(!1),[v,h]=a.useState(!0),[b,m]=a.useState(`/insect-360/${e.sequenceHiRes.path}${(s+1).toString().padStart(2,"0")}.${e.sequenceHiRes.filetype}`);return a.useEffect(()=>{n.length===e.sequenceFramecount&&h(!1)},[n]),a.useEffect(()=>{m(`/insect-360/${e.sequenceHiRes.path}${(s+1).toString().padStart(2,"0")}.${e.sequenceHiRes.filetype}`)},[e,s]),o.jsxs("div",{className:he["sequence-viewer"],children:[v&&o.jsx(E,{}),o.jsx(de,{setDisplayPhotoInfo:c,setDisplayPhotoViewer:p,activeImgIndex:s,setActiveImgIndex:r,imgCount:e.sequenceFramecount}),o.jsx(V,{img:n[s]}),i&&o.jsx(se,{setOpen:c,content:t.photoInfo}),u&&o.jsx(ce,{setOpen:p,imgPath:b})]})};export{pe as default};
